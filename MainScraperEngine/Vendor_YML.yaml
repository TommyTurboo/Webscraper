# ═══════════════════════════════════════════════════════════════
# VENDOR CONFIGURATIES - Configuration-Driven Scraper
# ═══════════════════════════════════════════════════════════════
# 
# Elke vendor heeft:
#   - detect: Regels om te detecteren of HTML van deze vendor is
#   - specs: Configuratie voor data extractie
#
# Detectie types:
#   - id: "element-id"
#   - selector: "css-selector"
#   - class_contains: "partial-class-name"
#   - text_contains: "zoek tekst in page"
#
# Spec types:
#   - type: "rows"      → Rij-gebaseerd (key-value per row)
#   - type: "li_split"  → LI elementen splitsen op newline
#   - type: "table"     → Tabel extractie
#   - type: "dl"        → Definition lists
# ═══════════════════════════════════════════════════════════════

siemens:
  name: "Siemens"
  priority: 10
  
  detect:
    - selector: "sie-ps-commercial-data"
    - selector: "sie-ps-technical-data"
    - id: "specifications"
    # Detectie voor variantenlijst pagina's
    - selector: "sie-pl-product-catalog-list-item"
  
  specs:
    # 1. Extractie uit Technical Data table
    - type: "table"
      # Container verwijderd: we zoeken in het hele document omdat de HTML samengevoegd is
      # container: "sie-ps-technical-data" 
      tables: "table.TEPreviewTable, sie-ps-technical-data table"
      extract_mode: "key_value"  # Elke rij = key-value pair
      # FIX: De HTML gebruikt colspan="2" voor de eerste cel. Fysiek zijn er dus maar 2 <td> elementen.
      key_column: 0    # Eerste element (bevat de naam)
      value_column: 1  # Tweede element (bevat de waarde)
      skip_rows_with_class: "hc"  # Skip header rows (class="hc")
      
    # 2. Extractie uit Commercial Data (list-based structure)
    - type: "rows"
      container: "sie-ps-commercial-data"
      rows: "li"
      key: ".commercial-data-section__subtitle"
      value: "p:not(.commercial-data-section__subtitle)"
      multiple_values: false
      
    # 3. FALLBACK: Li-items (voor andere Siemens pagina's)
    - type: "li_split"
      container: "#specifications"
      section_headers: ["h3", "h4"]
      items: "li"
      split_on: "\n"
      skip_texts:
        - "commercial data"
        - "technical data"
        - "productdetails"
    
    # 4. Product Varianten Lijst
    - type: "product_variants"
      # AANGEPAST: Specifieker zoeken in #productVariants container om 'Related Products' te negeren.
      # We pakken direct de .catalog-list-item kaartjes.
      variant_selector: "#productVariants .catalog-list-item"
      base_url: "https://sieportal.siemens.com" # Voeg base_url toe voor relatieve links
      fields:
        # Artikelnummer (uit titel link)
        title: ".catalog-list-item__identifier a"
        # URL naar detailpagina (scraper gebruikt automatisch base_url indien aanwezig)
        url: ".catalog-list-item__identifier a"
        # Omschrijving: Selector versimpeld om zeker te zijn dat tekst gepakt wordt
        description: ".catalog-list-item__description"
        # Afbeelding: Specifieker op img tag
        image: "img.catalog-list-item__image-wrapper__image"
        # Price extraction configuration (Siemens)
        # Based on user-provided HTML structure:
        # First span is List Price (often ends with /)
        list_price: ".product-price__price__span:nth-of-type(1)"
        # Second span is Your Price
        your_price: ".product-price__price__span:nth-of-type(2)"

    # ✨ NIEUWE: Description uit META tag
    - type: "meta_description"
      description: "Product description from meta tag"
      selector: "meta[name='description']"
      attribute: "content"
      target_section: "Product Info"
      target_key: "Description"
    
    # ✨ NIEUW: Product Image
    - type: "attribute"
      description: "Product image URL"
      selector: ".ps__img[src], img[alt*='3RA']"
      attribute: "src"
      target_section: "Product Info"
      target_key: "Image URL"
    
    # ✨ NIEUWE: Datasheet link via data-ste attribuut
    - type: "datasheet_link"
      selectors:
        - "a[data-ste*='Datasheet']"
        - "a[href*='teddatasheet']"
      attribute: "href"
      target_section: "Downloads"
      target_key: "Datasheet"

vega:
  name: "VEGA"
  priority: 35  # ← VERHOOG deze (hoger = later checken)
  
  detect:
    - class_contains: "characteristic-title"  # ← Specifieker maken
    - class_contains: "technical-data-content"
    - text_contains: "VEGA Grieshaber" 
  specs:
    # ✨ FIX: Text extractor ipv meta_description
    - type: "text"
      selector: "div.product-application-text"
      target_section: "Product Info"
      target_key: "Description"
      # ✨ NIEUW: Product image (met post-processing)
    - type: "attribute"
      selector: "div.cbp-item img[alt*='VEGA']"
      attribute: "src"
      target_section: "Product Info"
      target_key: "Image URL"
      post_process: "prepend_base_url"

    - type: "rows"
      rows: "div.characteristic"
      key: ".characteristic-title"
      value: "li.characteristic-value"
      multiple_values: true
      remove_noise:
        - ".unit-choices"
        - ".unit-choice"
        - ".unit-choice-spacer"
    
    # ✨ NIEUW: PDF Downloads Extractor
    - type: "vega_pdf"
      description: "Extract PDF download URLs from document cards"
      target_section: "Downloads"
      base_url: "https://www.vega.com"
      cards_selector: "div.cards"
      card_selector: "div.card"

nexans:
  name: "Nexans"
  priority: 30
  
  detect:
    - class_contains: "list-characteristics__row"
    - text_contains: "nexans ref"
  
  specs:
    # 1. Product variants (uit productlijst)
    - type: "product_variants"
      container: "body"
      variant_selector: ".product__list__item"
      base_url: "https://www.nexans.be"  # Voeg base_url toe voor Nexans
      fields:
        title: ".product__list__item__title"
        ref: ".product__list__item__ref"
        url: ".product__list__item__title a"
        specs:
          rows: ".list-label__item"
          key: ".list-label__item__label"
          value: ".list-label__item"
    
    # 2. Karakteristieken (uit detail pagina)
    - type: "rows"
      rows: ".list-characteristics__row"
      key: ".list-characteristics__title"
      value: ".list-characteristics__desc"
      multiple_values: false

    # 3. ✨ NIEUW: Datasheet link download
    - type: "datasheet_link"
      target_section: "Downloads"
      target_key: "Datasheet"
      base_url: "https://www.nexans.be"
      selectors:
        - "a.product__downloads__file__link[data-ga-type='datasheet']"
        - "a[href*='/product/pdf/']"

phoenix:
  name: "Phoenix Contact"
  priority: 40
  
  detect:
    - text_contains: "phoenix contact"
    - class_contains: "productdetails"
  
  specs:
    # ✨ NIEUW: Product description uit META tag
    - type: "meta_description"
      description: "Product description from meta tag"
      selector: "meta[name='description']"
      attribute: "content"
      target_section: "Product Info"
      target_key: "Description"
    
    # ✨ NIEUW: Product image URL uit Open Graph meta tag
    - type: "attribute"
      description: "Product image URL from Open Graph meta tag"
      selector: "meta[property='og:image']"
      attribute: "content"
      target_section: "Product Info"
      target_key: "Image URL"
    
    # Bestaande extractors
    - type: "table"
      container: ".productdetails"
      tables: "table"
    
    - type: "dl"
      container: ".specifications"
    
    # ✨ NIEUW: PDF Datasheet URL Generator
    - type: "phoenix_pdf"
      description: "Generate PDF datasheet download URL"
      article_key: "Artikelnummer"
      article_section: "Productdetails"
      target_section: "Downloads"
      target_key: "PDF Datasheet"
      realm: "be"
      locale: "nl-BE"

abb:
  name: "ABB"
  priority: 15
  
  detect:
    # Detectie niet meer nodig - canonical URL check werkt beter!
    # Zie detector.py voor domain-based detection
  
  specs:
    # ABB gebruikt JSON-data embedded in JavaScript: var model = {...}
    - type: "abb_json"
      description: "Extract product data from var model JavaScript object"
      
      # De extractor zoekt automatisch naar:
      # 1. var model = {...}; (ProductViewModel met attributeGroups)
      # 2. <script type="application/ld+json"> (Schema.org data)
      
      extract:
        # Basis product info (uit LD+JSON of ProductViewModel)
        product_id:
          path: "sku"
        
        product_name:
          path: "name"
        
        image:
          path: "image"
          target_key: "Image URL"
        
        # Specificaties worden automatisch geëxtraheerd uit:
        # ProductViewModel.Product.attributeGroups.items[]
        # Geen configuratie nodig - de extractor vindt het zelf!
        specifications: {}

schneider:
  name: "Schneider Electric"
  priority: 20
  
  detect:
    - selector: "[plain-all-data]"  # Schneider gebruikt JSON-in-attribute
    - text_contains: "schneider electric"
    - class_contains: "schneider"
  
  specs:
    # Schneider gebruikt een speciaal JSON-extractie type
    - type: "schneider_json"
      json_attribute: "plain-all-data"
      json_selector: "[plain-all-data]"
      extract:
        product_id:
          path: "base.productId"
          fallback_path: "base.productCR"
        variants:
          path: "base.variants.chars"
          extract_fields:
            - "productId"
        specifications:
          path: "specifications.characteristicTables"
          table_name_key: "tableName"
          rows_key: "rows"
          char_name_key: "characteristicName"
          char_values_key: "characteristicValues"
          label_key: "labelText"
        description:
          path: "specifications.longDescSentences"
        metadata:
          dataSheetTitle: "dataSheetTitle"
          breadcrumbs: "breadcrumbs"
        image:
          enabled: true
          search_patterns:
            - 'download\.schneider-electric\.com/files\?p_Doc_Ref=[^"&]+(?:&amp;|&)p_File_Type=rendition_(?:369|520|1500)_jpg'
            - 'meta\[property="og:image"\]'
          preferred_resolution: "rendition_369_jpg"
          target_section: "Product Info"
          target_key: "Image URL"

# ═══════════════════════════════════════════════════════════════
# GENERIEKE FALLBACK - Wordt gebruikt als geen vendor matcht
# ═══════════════════════════════════════════════════════════════
generic:
  name: "Generic"
  priority: 999  # Laagste prioriteit
  
  detect:
    - always: true  # Altijd matchen als fallback
  
  specs:
    # Probeer alle mogelijke patronen
    - type: "dl"
      container: "body"
    
    - type: "table"
      container: "body"
      tables: "table"
    
    - type: "label_value"
      pattern: "^(.{2,80}):\\s*(.{1,200})$"
      elements: ["p", "li", "div", "span"]
    
    - type: "li_split"
      container: "body"
      items: "li"
      split_on: "\n"
      min_parts: 2